```{r r_setup, include = FALSE}
# snakemake <- readRDS(".emg.Rmd.RDS")
snakemake@source("R/rmd_setup.R")
library(foreach)
library(data.table)
library(dplyr)

config <- snakemake@config

scriptdir <- snakemake@scriptdir
prefix <- snakemake@params$prefix
region <- snakemake@wildcards$region

samples <- fread(snakemake@input$samples)
samples <- samples[ Region %in% region ]
```

---
date: <small>`r Sys.Date()`</small>
author: <small>`r config$report$author`</small>
title: `r config$report$title`
---

```{python python_setup}
import mne
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

with open(f"{r.scriptdir}/python/plot_all_events.py", "r") as file:
    exec(file.read())
```

# Detection of movement episodes in `r gsub(region, pattern = "_", replacement = " ")` {.tabset .tabset-pills .unlisted .unnumbered}

```{r results}
pages <- foreach::foreach(animalId = samples[ , AnimalID ], cellName = samples[ , CellName ]) %do% {
  knitr::knit_child(glue::glue("{snakemake@scriptdir}/reports/components/emg.Rmd"), quiet = TRUE, envir = environment())
}
```
```{r, include = TRUE, results = "asis"}
cat(unlist(pages), sep = "\n")
```
